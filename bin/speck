#! /usr/bin/python

"""speck -- rpm spec modification tool

Usage:
    speck [spec] ( p | patch ) ( a | add ) <file>
    speck [spec] ( p | patch ) ( d | disable ) <number>
    speck [spec] ( p | patch ) ( e | enable ) <number>
    speck [spec] ( p | patch ) ( l | list )

Options:
    -h --help   Show this screen
    -d --debug  Print debug information
"""

from glob import glob
import sys

from docopt import docopt
from speck import spec
from tabulate import tabulate

parser = spec()

if __name__ == '__main__':
    arguments = docopt(__doc__)

    if not arguments['spec']:
        specs = glob('./*.spec')
        if len(specs) > 1:
            print "Multiple spec file in current directory, please specify one"
            sys.exit(1)
        elif len(specs) == 0:
            print "No spec file found in current directory"
            sys.exit(1)
        arguments['spec'] = specs[0]

    parser.parse(arguments['spec'])

    if arguments['patch'] or arguments['p']:
        if arguments['add'] or arguments['a']:
            parser.add_patch(arguments['<file>'])
        elif arguments['enable'] or arguments['e']:
            parser.enable_patch(arguments['<number>'])
        elif arguments['disable'] or arguments['d']:
            parser.disable_patch(arguments['<number>'])
        elif arguments['list'] or arguments['l']:
            patches = []
            for patch in parser.patches:
                patches += [[patch.patch_number, patch.source]]
            print tabulate(patches, headers=['', 'file'])
